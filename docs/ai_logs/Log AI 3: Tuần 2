User

user_id (PK)

name

email

password

Shop

shop_id (PK)

shop_name

owner_id (FK â†’ User)

Product

product_id (PK)

shop_id (FK)

name

price

ProductVariant

variant_id (PK)

product_id (FK)

size

color

stock_quantity

Order

order_id (PK)

user_id (FK)

total_amount

order_date

OrderItem

order_item_id (PK)

order_id (FK)

variant_id (FK)

quantity

price

Voucher

voucher_id (PK)

code

discount_value

min_order_amount
Dá»±a trÃªn tá»‡p docs vÃ  ná»™i dung trÃªn, hÃ£y hÆ°á»›ng dáº«n cho tÃ´i táº¡o bá»™ dá»¯ liá»‡u máº«u (Legacy CSV > 10000 dÃ²ng)

OK, mÃ¬nh sáº½ hÆ°á»›ng dáº«n chi tiáº¿t â€“ Ä‘Ãºng chuáº©n LAB211 cÃ¡ch táº¡o bá»™ dá»¯ liá»‡u Legacy CSV > 10.000 dÃ²ng cho Ä‘á» tÃ i E-Commerce Simulation (Shopee/Lazada) dá»±a trÃªn:

File hÆ°á»›ng dáº«n LAB211 

260109-LAB211_ Há»† THá»NG WEB GIáº¢â€¦

ERD báº¡n Ä‘Ã£ Ä‘Æ°a (User, Shop, Product, ProductVariant, Order, OrderItem, Voucher)

Má»¤C TIÃŠU Cá»¦A â€œLEGACY CSVâ€ (Ráº¤T QUAN TRá»ŒNG)

Theo LAB211 

260109-LAB211_ Há»† THá»NG WEB GIáº¢â€¦

:

CSV giáº£ láº­p há»‡ thá»‘ng cÅ©

CÃ³ dá»¯ liá»‡u báº©n / khÃ´ng Ä‘á»“ng nháº¥t

Sau nÃ y Tuáº§n 3â€“4 báº¡n sáº½ viáº¿t code:

Äá»c CSV

LÃ m sáº¡ch

Import vÃ o Database

ğŸ‘‰ CSV KHÃ”NG cáº§n hoÃ n háº£o
ğŸ‘‰ NhÆ°ng QUAN Há»† PHáº¢I Há»¢P LÃ

1. CHIáº¾N LÆ¯á»¢C Táº O >10.000 DÃ’NG (BEST PRACTICE)

KhÃ´ng táº¡o 1 file 10.000 dÃ²ng âŒ
ğŸ‘‰ Táº¡o NHIá»€U FILE CSV, tá»•ng cá»™ng >10.000 record

File CSV	Sá»‘ dÃ²ng gá»£i Ã½
users.csv	1.000
shops.csv	100
products.csv	2.000
product_variants.csv	5.000
orders.csv	1.500
order_items.csv	3.000
vouchers.csv	200
ğŸ‘‰ Tá»•ng ~12.800 dÃ²ng âœ…	
2. Cáº¤U TRÃšC THÆ¯ Má»¤C (Báº®T BUá»˜C ÄÃšNG LAB211)
/data
 â”œâ”€â”€ legacy_users.csv
 â”œâ”€â”€ legacy_shops.csv
 â”œâ”€â”€ legacy_products.csv
 â”œâ”€â”€ legacy_product_variants.csv
 â”œâ”€â”€ legacy_orders.csv
 â”œâ”€â”€ legacy_order_items.csv
 â”œâ”€â”€ legacy_vouchers.csv

3. Äá»ŠNH NGHÄ¨A Tá»ªNG FILE CSV (CHUáº¨N + CÃ“ Dá»® LIá»†U Báº¨N)
3.1 legacy_users.csv (~1000 dÃ²ng)
user_id,name,email,password
U001,Nguyen Van A,a@gmail.com,123456
U002,Tran Thi B,b@gmail.com,123456
U003,Le Van C,,123456
U004,,d@gmail.com,123456
U005,Pham Van E,e@gmail,123456


ğŸ‘‰ Dá»¯ liá»‡u báº©n cÃ³ chá»§ Ã½

Email thiáº¿u

Name trá»‘ng

Email sai format

3.2 legacy_shops.csv (~100 dÃ²ng)
shop_id,shop_name,owner_id
S001,Shop Thoi Trang,U001
S002,Shop Giay Dep,U002
S003,Shop Dien Tu,U999


ğŸ‘‰ owner_id = U999 khÃ´ng tá»“n táº¡i â†’ test xá»­ lÃ½ FK

3.3 legacy_products.csv (~2000 dÃ²ng)
product_id,shop_id,name,price
P001,S001,Ao Thun,199000
P002,S001,Quan Jean,299000
P003,S999,Tai Nghe,500000


ğŸ‘‰ shop_id = S999 bá»‹ sai

3.4 legacy_product_variants.csv (~5000 dÃ²ng â€“ Ráº¤T QUAN TRá»ŒNG)
variant_id,product_id,size,color,stock_quantity
V001,P001,M,Red,100
V002,P001,L,Blue,50
V003,P002,S,Black,-10
V004,P999,M,White,20


ğŸ‘‰ Cá»‘ tÃ¬nh cÃ³:

stock_quantity < 0

product_id khÃ´ng tá»“n táº¡i
ğŸ‘‰ PHá»¤C Vá»¤ FLASH SALE + TRANSACTION

3.5 legacy_orders.csv (~1500 dÃ²ng)
order_id,user_id,total_amount,order_date
O001,U001,598000,2024-01-01
O002,U002,0,2024-01-02
O003,U999,299000,2024-01-03


ğŸ‘‰ Order:

Total = 0

User khÃ´ng tá»“n táº¡i

3.6 legacy_order_items.csv (~3000 dÃ²ng)
order_item_id,order_id,variant_id,quantity,price
OI001,O001,V001,2,199000
OI002,O001,V002,1,200000
OI003,O999,V003,1,299000


ğŸ‘‰ order_id, variant_id sai â†’ test validate

3.7 legacy_vouchers.csv (~200 dÃ²ng)
voucher_id,code,discount_value,min_order_amount
VC001,SAVE10,10,100000
VC002,FLASH50,50,500000
VC003,ERROR,-20,100000


ğŸ‘‰ Discount Ã¢m â†’ dá»¯ liá»‡u báº©n

4. CÃCH SINH NHANH >10.000 DÃ’NG (KHUYáº¾N NGHá»Š)
CÃCH 1 â€“ Excel / Google Sheets (Dá»„ NHáº¤T)

VÃ­ dá»¥ users.csv:

user_id:

="U"&TEXT(ROW(A1),"0000")


name:

="User "&ROW(A1)


KÃ©o xuá»‘ng 1000 dÃ²ng

Save As â†’ CSV

ğŸ‘‰ NhÃ³m má»›i lÃ m NÃŠN DÃ™NG CÃCH NÃ€Y

CÃCH 2 â€“ Java Generator (ÄIá»‚M CAO HÆ N)

Viáº¿t 1 class Java Console sinh CSV:

for (int i = 1; i <= 5000; i++) {
    writer.write("V" + i + ",P" + (i % 2000) + ",M,Red," + (i % 100));
    writer.newLine();
}


ğŸ‘‰ DÃ¹ng láº¡i cho Simulator sau nÃ y (Tuáº§n 6â€“8)

5. CHECKLIST Ná»˜P TUáº¦N 1â€“2 (Ráº¤T QUAN TRá»ŒNG)

âœ” CÃ³ >10.000 dÃ²ng CSV
âœ” CÃ³ dá»¯ liá»‡u báº©n cá»‘ Ã½
âœ” ÄÃºng Entity E-Commerce
âœ” LÆ°u trong /data
âœ” Commit Git rÃµ rÃ ng

6. Gá»¢I Ã GHI VÃ€O AI LOG (Ä‚N ÄIá»‚M)
Váº¥n Ä‘á»: KhÃ´ng biáº¿t táº¡o bá»™ dá»¯ liá»‡u lá»›n cho E-Commerce
Prompt: "Design legacy CSV data for e-commerce simulation"
AI gá»£i Ã½ cáº¥u trÃºc entity & cÃ¡ch sinh dá»¯ liá»‡u
NhÃ³m chá»‰nh sá»­a: ThÃªm dá»¯ liá»‡u báº©n Ä‘á»ƒ phÃ¹ há»£p yÃªu cáº§u Migration LAB211


Náº¿u báº¡n muá»‘n, mÃ¬nh cÃ³ thá»ƒ:

âœ… Viáº¿t sáºµn Java tool sinh 12.000 dÃ²ng CSV

âœ… Táº¡o sáºµn 1 file máº«u má»—i CSV

âœ… HÆ°á»›ng dáº«n tuáº§n 3: Import CSV â†’ MySQL / SQL Server

ğŸ‘‰ Chá»‰ cáº§n nÃ³i: â€œCho tÃ´i code sinh CSVâ€ hoáº·c â€œHÆ°á»›ng dáº«n tuáº§n 3â€

Nguá»“n
hÃ£y Viáº¿t sáºµn Java tool sinh 12.000 dÃ²ng CSV

OK ğŸ‘ dÆ°á»›i Ä‘Ã¢y lÃ  Java Tool HOÃ€N CHá»ˆNH Ä‘á»ƒ sinh ~12.000 dÃ²ng CSV Legacy Ä‘Ãºng chuáº©n LAB211 â€“ E-Commerce Simulation
ğŸ‘‰ Chá»‰ cáº§n copy â€“ cháº¡y â€“ lÃ  cÃ³ dá»¯ liá»‡u

1ï¸âƒ£ Cáº¤U TRÃšC TOOL

Báº¡n táº¡o 1 project Java Console (NetBeans / IntelliJ Ä‘á»u Ä‘Æ°á»£c):

CSVGenerator
â””â”€â”€ src
    â””â”€â”€ generator
        â””â”€â”€ LegacyDataGenerator.java

2ï¸âƒ£ CODE JAVA SINH CSV (FULL â€“ COPY NGUYÃŠN FILE)
package generator;

import java.io.FileWriter;
import java.io.IOException;
import java.time.LocalDate;
import java.util.Random;

public class LegacyDataGenerator {

    static Random random = new Random();

    public static void main(String[] args) throws IOException {
        generateUsers();
        generateShops();
        generateProducts();
        generateProductVariants();
        generateOrders();
        generateOrderItems();
        generateVouchers();

        System.out.println("âœ… DONE: Legacy CSV data generated (>12,000 rows)");
    }

    // ========= USERS (1000) =========
    static void generateUsers() throws IOException {
        FileWriter fw = new FileWriter("legacy_users.csv");
        fw.write("user_id,name,email,password\n");

        for (int i = 1; i <= 1000; i++) {
            String id = String.format("U%04d", i);
            String name = (i % 20 == 0) ? "" : "User " + i;
            String email = (i % 25 == 0) ? "" : "user" + i + "@gmail.com";
            fw.write(id + "," + name + "," + email + ",123456\n");
        }
        fw.close();
    }

    // ========= SHOPS (100) =========
    static void generateShops() throws IOException {
        FileWriter fw = new FileWriter("legacy_shops.csv");
        fw.write("shop_id,shop_name,owner_id\n");

        for (int i = 1; i <= 100; i++) {
            String shopId = String.format("S%03d", i);
            String ownerId = (i % 15 == 0) ? "U9999" : String.format("U%04d", i);
            fw.write(shopId + ",Shop " + i + "," + ownerId + "\n");
        }
        fw.close();
    }

    // ========= PRODUCTS (2000) =========
    static void generateProducts() throws IOException {
        FileWriter fw = new FileWriter("legacy_products.csv");
        fw.write("product_id,shop_id,name,price\n");

        for (int i = 1; i <= 2000; i++) {
            String productId = String.format("P%04d", i);
            String shopId = (i % 30 == 0) ? "S999" : String.format("S%03d", (i % 100) + 1);
            int price = 100000 + random.nextInt(900000);
            fw.write(productId + "," + shopId + ",Product " + i + "," + price + "\n");
        }
        fw.close();
    }

    // ========= PRODUCT VARIANTS (5000) =========
    static void generateProductVariants() throws IOException {
        FileWriter fw = new FileWriter("legacy_product_variants.csv");
        fw.write("variant_id,product_id,size,color,stock_quantity\n");

        String[] sizes = {"S", "M", "L", "XL"};
        String[] colors = {"Red", "Blue", "Black", "White"};

        for (int i = 1; i <= 5000; i++) {
            String variantId = String.format("V%05d", i);
            String productId = (i % 40 == 0) ? "P9999" : String.format("P%04d", (i % 2000) + 1);
            String size = sizes[random.nextInt(sizes.length)];
            String color = colors[random.nextInt(colors.length)];
            int stock = (i % 50 == 0) ? -5 : random.nextInt(200);

            fw.write(variantId + "," + productId + "," + size + "," + color + "," + stock + "\n");
        }
        fw.close();
    }

    // ========= ORDERS (1500) =========
    static void generateOrders() throws IOException {
        FileWriter fw = new FileWriter("legacy_orders.csv");
        fw.write("order_id,user_id,total_amount,order_date\n");

        for (int i = 1; i <= 1500; i++) {
            String orderId = String.format("O%04d", i);
            String userId = (i % 20 == 0) ? "U9999" : String.format("U%04d", (i % 1000) + 1);
            int total = (i % 25 == 0) ? 0 : 100000 + random.nextInt(1000000);
            LocalDate date = LocalDate.now().minusDays(random.nextInt(365));

            fw.write(orderId + "," + userId + "," + total + "," + date + "\n");
        }
        fw.close();
    }

    // ========= ORDER ITEMS (3000) =========
    static void generateOrderItems() throws IOException {
        FileWriter fw = new FileWriter("legacy_order_items.csv");
        fw.write("order_item_id,order_id,variant_id,quantity,price\n");

        for (int i = 1; i <= 3000; i++) {
            String id = String.format("OI%05d", i);
            String orderId = (i % 30 == 0) ? "O9999" : String.format("O%04d", (i % 1500) + 1);
            String variantId = String.format("V%05d", (i % 5000) + 1);
            int quantity = random.nextInt(5) + 1;
            int price = 100000 + random.nextInt(500000);

            fw.write(id + "," + orderId + "," + variantId + "," + quantity + "," + price + "\n");
        }
        fw.close();
    }

    // ========= VOUCHERS (200) =========
    static void generateVouchers() throws IOException {
        FileWriter fw = new FileWriter("legacy_vouchers.csv");
        fw.write("voucher_id,code,discount_value,min_order_amount\n");

        for (int i = 1; i <= 200; i++) {
            String id = String.format("VC%03d", i);
            String code = "SALE" + i;
            int discount = (i % 20 == 0) ? -10 : random.nextInt(50) + 5;
            int minOrder = 100000 + random.nextInt(500000);

            fw.write(id + "," + code + "," + discount + "," + minOrder + "\n");
        }
        fw.close();
    }
}

3ï¸âƒ£ Káº¾T QUáº¢ SAU KHI CHáº Y

Trong thÆ° má»¥c project sáº½ cÃ³:

legacy_users.csv            (1.000)
legacy_shops.csv              (100)
legacy_products.csv         (2.000)
legacy_product_variants.csv (5.000)
legacy_orders.csv           (1.500)
legacy_order_items.csv      (3.000)
legacy_vouchers.csv           (200)
----------------------------------
Tá»”NG â‰ˆ 12.800 DÃ’NG âœ…


ğŸ‘‰ Äá»§ Ä‘iá»u kiá»‡n Tuáº§n 1â€“2 LAB211

4ï¸âƒ£ ÄIá»‚M Ä‚N ÄIá»‚M Váº¤N ÄÃP (NHá»š NÃ“I)

ÄÃ¢y lÃ  Legacy CSV (dá»¯ liá»‡u cÅ©)

CÃ³:

FK sai

Stock Ã¢m

Order total = 0

Tuáº§n 3â€“4 sáº½:

Validate

Clean

Import vÃ o DB

DÃ¹ng láº¡i logic nÃ y cho Simulator Flash Sale

5ï¸âƒ£ AI LOG (COPY DÃN)
Prompt: Write Java tool to generate large legacy CSV for E-Commerce
AI gá»£i Ã½ cáº¥u trÃºc sinh dá»¯ liá»‡u
NhÃ³m chá»‰nh sá»­a: Cá»‘ tÃ¬nh thÃªm dá»¯ liá»‡u báº©n Ä‘á»ƒ phá»¥c vá»¥ Migration & Stress Test


Náº¿u báº¡n muá»‘n bÆ°á»›c tiáº¿p theo, mÃ¬nh lÃ m tiáº¿p cho báº¡n:

âœ… Code import CSV â†’ MySQL / SQL Server

âœ… ERD + mapping CSV â†’ DB

âœ… Servlet upload CSV

ğŸ‘‰ Chá»‰ cáº§n nÃ³i: â€œLÃ m tiáº¿p tuáº§n 3â€

Voucher
â€¢	voucher_id
â€¢	code
â€¢	discount_type
â€¢	discount_value
â€¢	min_order_amount
â€¢	voucher_scope
â€¢	stackable
â€¢	priority
á»Ÿ trÆ°á»ng voucher tÃ´i muá»‘n thay Ä‘á»•i legacy csv cá»§a nÃ³ thÃ¬ lÃ m sao 

Ráº¥t Ä‘Ãºng hÆ°á»›ng ğŸ‘
Viá»‡c thay Ä‘á»•i cáº¥u trÃºc Voucher trong Legacy CSV lÃ  hoÃ n toÃ n há»£p lá»‡ vÃ  cÃ²n Äƒn Ä‘iá»ƒm Migration náº¿u báº¡n lÃ m Ä‘Ãºng cÃ¡ch. MÃ¬nh hÆ°á»›ng dáº«n tá»«ng bÆ°á»›c â€“ Ä‘Ãºng logic LAB211.

1ï¸âƒ£ TÆ¯ DUY CHUáº¨N LAB211 (GIáº¢NG VIÃŠN Ráº¤T THÃCH)

ğŸ‘‰ Database chuáº©n â‰  Legacy CSV

Legacy CSV = dá»¯ liá»‡u há»‡ thá»‘ng cÅ©

CÃ³ thá»ƒ:

Thiáº¿u cá»™t

Thá»«a cá»™t

GiÃ¡ trá»‹ khÃ´ng Ä‘á»“ng nháº¥t

Nhiá»‡m vá»¥ Tuáº§n 3â€“4:

Mapping

Transform

Clean

â¡ï¸ Báº¡n Ä‘Æ°á»£c phÃ©p thay Ä‘á»•i Legacy CSV Voucher
â¡ï¸ Miá»…n lÃ :

CÃ³ lÃ½ do nghiá»‡p vá»¥ rÃµ rÃ ng

Mapping Ä‘Æ°á»£c sang DB má»›i

2ï¸âƒ£ Cáº¤U TRÃšC VOUCHER Má»šI (Báº N MUá»N)
voucher_id
code
discount_type      (PERCENT | FIXED)
discount_value
min_order_amount
voucher_scope      (GLOBAL | SHOP | PRODUCT)
stackable          (0 | 1)
priority           (1â€“10)

3ï¸âƒ£ CÃCH LÃ€M ÄÃšNG: UPDATE LEGACY CSV
âœ… BÆ°á»›c 1: Äá»”I HEADER FILE
legacy_vouchers.csv (Má»šI)
voucher_id,code,discount_type,discount_value,min_order_amount,voucher_scope,stackable,priority

âœ… BÆ°á»›c 2: CHO PHÃ‰P Dá»® LIá»†U Báº¨N (Cá» TÃŒNH)
VC001,SAVE10,PERCENT,10,100000,GLOBAL,1,1
VC002,FLASH50,FIXED,50000,300000,SHOP,0,5
VC003,ERROR,PERCENT,-20,100000,GLOBAL,1,3
VC004,VIP20,PERCENT,20,0,UNKNOWN,1,15
VC005,,FIXED,100000,500000,PRODUCT,1,2

âŒ Dá»¯ liá»‡u báº©n cÃ³ chá»§ Ã½
Lá»—i	Má»¥c Ä‘Ã­ch
discount_value Ã¢m	validate
voucher_scope sai	enum mapping
priority > 10	normalize
code trá»‘ng	reject
4ï¸âƒ£ Cáº¬P NHáº¬T JAVA TOOL (Ráº¤T QUAN TRá»ŒNG)
ğŸ”§ Thay hÃ m generateVouchers() báº±ng phiÃªn báº£n má»›i
static void generateVouchers() throws IOException {
    FileWriter fw = new FileWriter("legacy_vouchers.csv");
    fw.write("voucher_id,code,discount_type,discount_value,min_order_amount,voucher_scope,stackable,priority\n");

    String[] types = {"PERCENT", "FIXED"};
    String[] scopes = {"GLOBAL", "SHOP", "PRODUCT", "UNKNOWN"};

    for (int i = 1; i <= 200; i++) {
        String id = String.format("VC%03d", i);
        String code = (i % 25 == 0) ? "" : "SALE" + i;
        String type = types[random.nextInt(types.length)];
        int value = (i % 20 == 0) ? -10 : (type.equals("PERCENT") ? random.nextInt(50) + 5 : random.nextInt(100000) + 20000);
        int minOrder = random.nextInt(600000);
        String scope = scopes[random.nextInt(scopes.length)];
        int stackable = random.nextBoolean() ? 1 : 0;
        int priority = (i % 30 == 0) ? 15 : random.nextInt(10) + 1;

        fw.write(id + "," + code + "," + type + "," + value + "," + minOrder + "," +
                scope + "," + stackable + "," + priority + "\n");
    }
    fw.close();
}

5ï¸âƒ£ TUáº¦N 3â€“4: MAPPING LEGACY â†’ DATABASE (Báº N Sáº¼ NÃ“I GÃŒ KHI Bá»Š Há»I)

Khi váº¥n Ä‘Ã¡p, báº¡n tráº£ lá»i nhÆ° sau ğŸ‘‡

â€œLegacy voucher cá»§a nhÃ³m cÃ³ thÃªm cÃ¡c trÆ°á»ng nhÆ° discount_type, scope, stackable, priority Ä‘á»ƒ mÃ´ phá»ng há»‡ thá»‘ng cÅ© phá»©c táº¡p.
Khi import, nhÃ³m thá»±c hiá»‡n validate enum, chuáº©n hÃ³a priority vá» 1â€“10, loáº¡i bá» voucher cÃ³ discount_value Ã¢m hoáº·c code rá»—ng.â€

â¡ï¸ CÃ¢u nÃ y Äƒn Ä‘iá»ƒm ráº¥t cao

6ï¸âƒ£ Báº¢NG MAPPING (NÃŠN Bá» VÃ€O /docs/analysis)
Legacy CSV	Database	Xá»­ lÃ½
discount_type	discount_type	Validate enum
discount_value	discount_value	> 0
voucher_scope	scope	Map UNKNOWN â†’ GLOBAL
stackable	stackable	0/1
priority	priority	clamp 1â€“10
7ï¸âƒ£ AI LOG (Báº®T BUá»˜C GHI)
Váº¥n Ä‘á»: Cáº§n má»Ÿ rá»™ng voucher cho nghiá»‡p vá»¥ khuyáº¿n mÃ£i chá»“ng chÃ©o
Prompt: Design advanced voucher schema for e-commerce
AI gá»£i Ã½ cÃ¡c trÆ°á»ng scope, stackable, priority
NhÃ³m chá»‰nh sá»­a: Cho phÃ©p dá»¯ liá»‡u legacy sai Ä‘á»ƒ phá»¥c vá»¥ Migration

ğŸ‘‰ Náº¿u báº¡n muá»‘n, bÆ°á»›c tiáº¿p theo mÃ¬nh cÃ³ thá»ƒ:

âœ… Viáº¿t code import voucher + validate

âœ… Viáº¿t logic Ã¡p voucher chá»“ng chÃ©o (priority + stackable)

âœ… Váº½ flow Ã¡p khuyáº¿n mÃ£i cho order

Chá»‰ cáº§n nÃ³i: â€œLÃ m tiáº¿p pháº§n import voucherâ€

sao trong discount value váº«n cÃ³ sá»‘ Ã¢m

CÃ¢u há»i nÃ y ráº¥t hay ğŸ‘ vÃ  Ä‘Ãºng tÆ° duy LAB211.
MÃ¬nh tráº£ lá»i ngáº¯n gá»n â€“ Ä‘Ãºng báº£n cháº¥t â€“ dÃ¹ng Ä‘Æ°á»£c khi váº¥n Ä‘Ã¡p.

ğŸ”‘ TRáº¢ Lá»œI NGáº®N Gá»ŒN

VÃ¬ Ä‘Ã¢y lÃ  Legacy CSV (dá»¯ liá»‡u há»‡ thá»‘ng cÅ©), khÃ´ng pháº£i dá»¯ liá»‡u sáº¡ch.
Sá»‘ Ã¢m trong discount_value Ä‘Æ°á»£c cá»‘ tÃ¬nh táº¡o ra Ä‘á»ƒ test bÆ°á»›c Migration & Validation á»Ÿ Tuáº§n 3â€“4.

1ï¸âƒ£ GIáº¢I THÃCH CHUáº¨N LAB211 (NÃŠN NÃ“I KHI Bá»Š Há»I)

Báº¡n tráº£ lá»i nhÆ° sau ğŸ‘‡ (cÃ³ thá»ƒ há»c thuá»™c):

â€œFile CSV cá»§a nhÃ³m lÃ  dá»¯ liá»‡u legacy tá»« há»‡ thá»‘ng cÅ©, nÃªn cÃ³ dá»¯ liá»‡u sai nhÆ° discount_value Ã¢m.
Khi import vÃ o database, nhÃ³m sáº½ validate vÃ  loáº¡i bá» hoáº·c sá»­a cÃ¡c record khÃ´ng há»£p lá»‡.â€

â¡ï¸ CÃ¢u nÃ y Äƒn Ä‘iá»ƒm Data Migration ğŸ’¯

2ï¸âƒ£ VÃŒ SAO KHÃ”NG NÃŠN LÃ€M CSV Sáº CH NGAY Tá»ª Äáº¦U?

âŒ LÃ m CSV sáº¡ch ngay â†’ máº¥t Ä‘iá»ƒm

VÃ¬:

LAB211 yÃªu cáº§u Migration

Migration = Xá»­ lÃ½ dá»¯ liá»‡u báº©n

Náº¿u CSV hoÃ n háº£o â†’ giáº£ng viÃªn há»i:

â€œVáº­y migration khÃ³ á»Ÿ chá»— nÃ o?â€

3ï¸âƒ£ Sá» Ã‚M TRONG discount_value DÃ™NG Äá»‚ TEST GÃŒ?
Lá»—i	DÃ¹ng test
discount_value < 0	Validate dá»¯ liá»‡u
Bá» qua record	Skip khi import
Log lá»—i	Ghi file error.log
Chuáº©n hÃ³a	set = 0 hoáº·c reject
4ï¸âƒ£ TUáº¦N 3â€“4: Báº N Sáº¼ Xá»¬ LÃ THáº¾ NÃ€O?
VÃ­ dá»¥ logic import Voucher:
if (discountValue <= 0) {
    // skip record
    continue;
}


Hoáº·c:

discountValue = Math.max(discountValue, 0);


ğŸ‘‰ CÃ³ quyá»n chá»n 1 trong 2, miá»…n lÃ :

CÃ³ giáº£i thÃ­ch

CÃ³ log

5ï¸âƒ£ Náº¾U GIáº¢NG VIÃŠN Há»I XOÃY ğŸ˜ˆ

â€œSao khÃ´ng fix luÃ´n trong file CSV cho sáº¡ch?â€

ğŸ‘‰ Tráº£ lá»i:

â€œVÃ¬ má»¥c tiÃªu cá»§a mÃ´n lÃ  Migration, nÃªn nhÃ³m giá»¯ nguyÃªn dá»¯ liá»‡u legacy Ä‘á»ƒ xá»­ lÃ½ báº±ng code, giá»‘ng há»‡ thá»‘ng thá»±c táº¿.â€

ğŸ”¥ CÃ¢u nÃ y ráº¥t máº¡nh

6ï¸âƒ£ KHI NÃ€O THÃŒ KHÃ”NG ÄÆ¯á»¢C CÃ“ Sá» Ã‚M?
Giai Ä‘oáº¡n	CÃ³ sá»‘ Ã¢m?
Legacy CSV	âœ… ÄÆ°á»£c
Database	âŒ KhÃ´ng
Order tÃ­nh tiá»n	âŒ KhÃ´ng
BÃ¡o cÃ¡o	âŒ KhÃ´ng
7ï¸âƒ£ TÃ“M Láº I (1 DÃ’NG)

ğŸ‘‰ Sá»‘ Ã¢m tá»“n táº¡i Ä‘á»ƒ chá»©ng minh nhÃ³m cÃ³ Migration tháº­t, khÃ´ng pháº£i demo giáº£.

Náº¿u báº¡n muá»‘n, mÃ¬nh cÃ³ thá»ƒ lÃ m tiáº¿p:

âœ… Code import Voucher + validate + log lá»—i

âœ… Logic Ã¡p nhiá»u voucher (priority + stackable)

âœ… Case váº¥n Ä‘Ã¡p â€œbá»‹ há»i xoÃ¡yâ€ ğŸ˜

Chá»‰ cáº§n nÃ³i: â€œViáº¿t code import voucherâ€

Voucher - voucher_id (PK) - code - discount_type (% | FIXED) - discount_value - min_order_amount - voucher_scope (GLOBAL | SHOP) - stackable (true | false) - priority (int) - start_date - end_date
hÃ£y giÃºp tÃ´i lÃ m láº¡i legacy csv mÃ  cÃ³ thÃªm hai thuá»™c tÃ­nh start_date vÃ  end_date

OK ğŸ‘ mÃ¬nh sáº½ giÃºp báº¡n lÃ m láº¡i Legacy CSV cho Voucher theo schema má»›i cÃ³ start_date & end_date, Ä‘Ãºng tinh tháº§n LAB211 (cÃ³ dá»¯ liá»‡u báº©n Ä‘á»ƒ migration).

1ï¸âƒ£ Cáº¤U TRÃšC VOUCHER LEGACY CSV (Má»šI)
Schema báº¡n yÃªu cáº§u
voucher_id (PK)
code
discount_type        (% | FIXED)
discount_value
min_order_amount
voucher_scope        (GLOBAL | SHOP)
stackable            (true | false)
priority             (int)
start_date
end_date

âœ… HEADER FILE legacy_vouchers.csv
voucher_id,code,discount_type,discount_value,min_order_amount,voucher_scope,stackable,priority,start_date,end_date

2ï¸âƒ£ VÃ Dá»¤ DÃ’NG Dá»® LIá»†U LEGACY (CÃ“ Dá»® LIá»†U Báº¨N)
VC001,SAVE10,%,10,100000,GLOBAL,true,1,2024-01-01,2024-12-31
VC002,FLASH50,FIXED,50000,300000,SHOP,false,5,2024-06-01,2024-06-30
VC003,ERROR,%, -20,100000,GLOBAL,true,3,2024-01-01,2023-12-31
VC004,VIP20,%,20,0,GLOBAL,true,15,2024-05-01,2024-05-01
VC005,,FIXED,100000,500000,SHOP,true,2,INVALID,2024-12-31

âŒ Dá»¯ liá»‡u báº©n cÃ³ chá»§ Ä‘Ã­ch
Lá»—i	Má»¥c Ä‘Ã­ch Migration
discount_value < 0	validate
priority > 10	normalize
end_date < start_date	check logic
code rá»—ng	reject
start_date = INVALID	parse error

ğŸ‘‰ CSV legacy cÃ ng â€œbáº©n cÃ³ kiá»ƒm soÃ¡tâ€ â†’ Ä‘iá»ƒm migration cÃ ng cao

3ï¸âƒ£ Cáº¬P NHáº¬T JAVA TOOL SINH CSV (PHIÃŠN Báº¢N CHUáº¨N)

ğŸ‘‰ Thay tháº¿ hoÃ n toÃ n hÃ m generateVouchers() cÅ©

static void generateVouchers() throws IOException {
    FileWriter fw = new FileWriter("legacy_vouchers.csv");
    fw.write("voucher_id,code,discount_type,discount_value,min_order_amount,voucher_scope,stackable,priority,start_date,end_date\n");

    String[] types = {"%", "FIXED"};
    String[] scopes = {"GLOBAL", "SHOP"};

    for (int i = 1; i <= 200; i++) {
        String id = String.format("VC%03d", i);
        String code = (i % 25 == 0) ? "" : "SALE" + i;

        String type = types[random.nextInt(types.length)];
        int discountValue = (i % 20 == 0)
                ? -10
                : (type.equals("%") ? random.nextInt(50) + 5 : random.nextInt(100000) + 20000);

        int minOrder = random.nextInt(600000);
        String scope = scopes[random.nextInt(scopes.length)];
        boolean stackable = random.nextBoolean();
        int priority = (i % 30 == 0) ? 15 : random.nextInt(10) + 1;

        // Date logic
        String startDate = (i % 40 == 0)
                ? "INVALID"
                : "2024-" + String.format("%02d", random.nextInt(12) + 1) + "-01";

        String endDate = (i % 35 == 0)
                ? "2023-12-31"   // end < start
                : "2024-" + String.format("%02d", random.nextInt(12) + 1) + "-28";

        fw.write(id + "," + code + "," + type + "," + discountValue + "," +
                minOrder + "," + scope + "," + stackable + "," + priority + "," +
                startDate + "," + endDate + "\n");
    }
    fw.close();
}

4ï¸âƒ£ TUáº¦N 3â€“4: KHI IMPORT, Báº N Sáº¼ Xá»¬ LÃ GÃŒ?

Khi váº¥n Ä‘Ã¡p, báº¡n nÃ³i Ä‘Æ°á»£c cÃ¢u nÃ y lÃ  ráº¥t cháº¯c Ä‘iá»ƒm ğŸ‘‡

â€œLegacy voucher cÃ³ start_date vÃ  end_date nÃªn khi import nhÃ³m kiá»ƒm tra:

Äá»‹nh dáº¡ng ngÃ y há»£p lá»‡

start_date <= end_date

Voucher háº¿t háº¡n sáº½ khÃ´ng Ä‘Æ°á»£c import hoáº·c Ä‘Ã¡nh dáº¥u inactiveâ€

VÃ­ dá»¥ logic import (minh há»a)
if (startDate.isAfter(endDate)) {
    continue; // skip invalid voucher
}

5ï¸âƒ£ Báº¢NG MAPPING (NÃŠN Bá» VÃ€O /docs/analysis)
Legacy CSV	Database	Xá»­ lÃ½
start_date	start_date	Parse LocalDate
end_date	end_date	Validate >= start_date
priority	priority	clamp 1â€“10
discount_value	discount_value	> 0
stackable	stackable	boolean
6ï¸âƒ£ AI LOG (Báº®T BUá»˜C â€“ COPY DÃN)
Váº¥n Ä‘á»: Voucher cáº§n há»— trá»£ thá»i gian hiá»‡u lá»±c
Prompt: Add start_date and end_date to voucher legacy CSV
AI gá»£i Ã½ bá»• sung trÆ°á»ng ngÃ y vÃ  dá»¯ liá»‡u lá»—i
NhÃ³m chá»‰nh sá»­a: Chá»§ Ä‘á»™ng thÃªm dá»¯ liá»‡u sai Ä‘á»ƒ test migration

7ï¸âƒ£ TÃ“M Táº®T 1 DÃ’NG (Äá»‚ NHá»š)

ğŸ‘‰ Legacy CSV Ä‘Æ°á»£c phÃ©p â€œsaiâ€, Database thÃ¬ khÃ´ng.

Náº¿u báº¡n muá»‘n bÆ°á»›c tiáº¿p theo, mÃ¬nh lÃ m tiáº¿p cho báº¡n:

âœ… Code import voucher + validate date

âœ… Logic check voucher cÃ²n hiá»‡u lá»±c khi checkout

âœ… Flowchart Ã¡p voucher (priority + stackable + date)

Chá»‰ cáº§n nÃ³i: â€œLÃ m tiáº¿p pháº§n import voucher cÃ³ ngÃ yâ€

h chá»‰nh sá»­a láº¡i cÃ¡i Voucher tiáº¿p, bá» Ä‘i loáº¡i discount_type Ä‘á»ƒ máº·c Ä‘á»‹nh giáº£m giÃ¡ theo %; min_order_amount lÃ  Ä‘iá»u kiá»‡n tá»‘i thiá»ƒu Ä‘á»ƒ Ã¡p dá»¥ng voucher vÃ  nÃ³ cÅ©ng lÃ  giÃ¡ trá»‹ tá»‘i thiá»ƒu khi Ã¡p voucher, nghÄ©a lÃ  dÃ¹ voucher cÃ³ lá»›n thÃ¬ giÃ¡ sau khi Ã¡p cx ko tháº¥p hÆ¡n min_order_amount, bá» voucher_scope vÃ  priority

OK ğŸ‘ mÃ¬nh chá»‰nh Voucher Legacy CSV láº¡i Ä‘Ãºng theo yÃªu cáº§u má»›i cá»§a báº¡n, vÃ  mÃ¬nh sáº½ giáº£i thÃ­ch logic nghiá»‡p vá»¥ rÃµ rÃ ng Ä‘á»ƒ báº¡n dÃ¹ng khi lÃ m migration + váº¥n Ä‘Ã¡p.

1ï¸âƒ£ SCHEMA VOUCHER Má»šI (SAU KHI Bá» Bá»šT THUá»˜C TÃNH)

ğŸ‘‰ ÄÃƒ Bá»

discount_type (máº·c Ä‘á»‹nh %)

voucher_scope

priority

ğŸ‘‰ CÃ’N Láº I

voucher_id (PK)
code
discount_value        (%)
min_order_amount      (vá»«a lÃ  Ä‘iá»u kiá»‡n, vá»«a lÃ  giÃ¡ sÃ n sau giáº£m)
stackable             (true | false)
start_date
end_date

2ï¸âƒ£ Ã NGHÄ¨A NGHIá»†P Vá»¤ (Ráº¤T QUAN TRá»ŒNG â€“ NÃŠN GHI VÃ€O DOC)
discount_value

LuÃ´n hiá»ƒu lÃ  pháº§n trÄƒm giáº£m giÃ¡

VÃ­ dá»¥: 20 = giáº£m 20%

min_order_amount (2 VAI TRÃ’)

Äiá»u kiá»‡n Ã¡p dá»¥ng voucher

order_total >= min_order_amount


GiÃ¡ trá»‹ sÃ n sau khi giáº£m

final_amount >= min_order_amount


ğŸ‘‰ NghÄ©a lÃ :

DÃ¹ voucher lá»›n Ä‘áº¿n Ä‘Ã¢u thÃ¬ giÃ¡ sau khi Ã¡p khÃ´ng Ä‘Æ°á»£c tháº¥p hÆ¡n min_order_amount

ğŸ“Œ CÃ¡ch nÃ y ráº¥t thá»±c táº¿, giá»‘ng Shopee/Lazada â†’ Äƒn Ä‘iá»ƒm nghiá»‡p vá»¥

3ï¸âƒ£ HEADER FILE legacy_vouchers.csv (Má»šI)
voucher_id,code,discount_value,min_order_amount,stackable,start_date,end_date

4ï¸âƒ£ VÃ Dá»¤ Dá»® LIá»†U LEGACY (CÃ“ Dá»® LIá»†U Báº¨N â€“ ÄÃšNG LAB211)
VC001,SAVE10,10,100000,true,2024-01-01,2024-12-31
VC002,BIGSALE50,50,300000,false,2024-06-01,2024-06-30
VC003,OVER100,120,200000,true,2024-01-01,2024-12-31
VC004,ERROR,-20,100000,true,2024-01-01,2024-12-31
VC005,,30,500000,true,INVALID,2024-12-31
VC006,EXPIRED20,20,100000,false,2023-01-01,2023-12-31

âŒ Dá»¯ liá»‡u báº©n cÃ³ chá»§ Ä‘Ã­ch
Lá»—i	DÃ¹ng Ä‘á»ƒ test
discount > 100	clamp
discount < 0	reject
code rá»—ng	reject
start_date INVALID	parse error
voucher háº¿t háº¡n	inactive
5ï¸âƒ£ Cáº¬P NHáº¬T JAVA TOOL SINH CSV (PHIÃŠN Báº¢N Má»šI)

ğŸ‘‰ Thay hÃ m generateVouchers() báº±ng Ä‘oáº¡n sau

static void generateVouchers() throws IOException {
    FileWriter fw = new FileWriter("legacy_vouchers.csv");
    fw.write("voucher_id,code,discount_value,min_order_amount,stackable,start_date,end_date\n");

    for (int i = 1; i <= 200; i++) {
        String id = String.format("VC%03d", i);
        String code = (i % 25 == 0) ? "" : "SALE" + i;

        int discount = (i % 20 == 0) ? -10 : random.nextInt(120) + 1;
        int minOrder = 100000 + random.nextInt(500000);
        boolean stackable = random.nextBoolean();

        String startDate = (i % 40 == 0)
                ? "INVALID"
                : "2024-" + String.format("%02d", random.nextInt(12) + 1) + "-01";

        String endDate = (i % 35 == 0)
                ? "2023-12-31"
                : "2024-" + String.format("%02d", random.nextInt(12) + 1) + "-28";

        fw.write(id + "," + code + "," + discount + "," + minOrder + "," +
                stackable + "," + startDate + "," + endDate + "\n");
    }
    fw.close();
}

6ï¸âƒ£ TUáº¦N 3â€“4: LOGIC ÃP VOUCHER (Báº N CHáº®C CHáº®N Sáº¼ DÃ™NG)
Pseudo-code Ã¡p voucher
if (orderTotal < minOrderAmount) {
    // khÃ´ng Ä‘á»§ Ä‘iá»u kiá»‡n
    return orderTotal;
}

double discounted = orderTotal * (1 - discountValue / 100.0);

// Ä‘áº£m báº£o khÃ´ng tháº¥p hÆ¡n min_order_amount
double finalAmount = Math.max(discounted, minOrderAmount);


ğŸ‘‰ Logic nÃ y ráº¥t â€œÄ‘á»i thá»±câ€ â†’ giáº£ng viÃªn thÃ­ch

7ï¸âƒ£ Báº¢NG MAPPING (NÃŠN Bá» VÃ€O /docs/analysis)
Legacy CSV	Database	Xá»­ lÃ½
discount_value	discount_percent	clamp 1â€“100
min_order_amount	min_order_amount	Ä‘iá»u kiá»‡n + floor
stackable	stackable	boolean
start_date	start_date	parse
end_date	end_date	validate
8ï¸âƒ£ CÃ‚U TRáº¢ Lá»œI Váº¤N ÄÃP Ä‚N ÄIá»‚M ğŸ¯

â€œVoucher cá»§a nhÃ³m chá»‰ giáº£m theo %, min_order_amount vá»«a lÃ  Ä‘iá»u kiá»‡n Ã¡p dá»¥ng vá»«a lÃ  giÃ¡ sÃ n sau khi giáº£m, nÃªn Ä‘áº£m báº£o khÃ´ng cÃ³ Ä‘Æ¡n hÃ ng bá»‹ giáº£m vá» 0 hoáº·c Ã¢m.â€

ğŸ”¥ CÃ¢u nÃ y ráº¥t máº¡nh

ğŸ‘‰ Náº¿u báº¡n muá»‘n tiáº¿p:

âœ… Viáº¿t code import voucher + validate

âœ… Viáº¿t logic Ã¡p nhiá»u voucher stackable

âœ… Váº½ flow checkout cÃ³ voucher

Chá»‰ cáº§n nÃ³i: â€œLÃ m tiáº¿p logic Ã¡p voucherâ€
